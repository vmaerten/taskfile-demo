version: 3

includes:
  frontend:
    taskfile: ./frontend/Taskfile.yml
    dir: ./frontend
  backend:
    taskfile: https://raw.githubusercontent.com/vmaerten/taskfile-demo/remove-taskfile/Taskfile.go.yml
    dir: ./backend
    vars:
      BINARY: backend
  cli:
    taskfile: ./Taskfile.go.yml
    dir: ./cli
    vars:
      BINARY: cli

tasks:
  deploy:
    deps:
      - frontend:build
      - backend:build
      - cli:build
    internal: true
    requires:
      vars:
        - ENV
    preconditions:
      - sh: command -v terraform
        msg: "Terraform needs to be installed"
    cmds:
      - echo "deploying to {{.ENV}} ...."

  deploy/dev:
    cmds:
      - task: deploy
        vars:
          ENV: dev

  deploy/prod:
    prompt: "Are you sure to deploy to prod ?"
    cmds:
      - task: deploy
        vars: { ENV: prod }
